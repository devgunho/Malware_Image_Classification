import math
import os
import sys

import file_open_easygui as fopen

from PIL import Image
from PyQt5 import QtCore, QtGui, QtWidgets
from PyQt5 import uic

# import .ui file
# .ui file must be located in the same directory as the Python code file.
form_class = uic.loadUiType("MainWindow.ui")[0]


def getBinaryData(filename):
    binaryValues = []
    file = open(filename, "rb")
    data = file.read(1)
    while data != b"":
        try:
            binaryValues.append(ord(data))
        except TypeError:
            pass
        data = file.read(1)
    return binaryValues


class WindowClass(QtWidgets.QMainWindow, form_class):   # GUI Class Define
    def __init__(self):
        super().__init__()
        self.setupUi(self)

        self.fileOpen_Btn.clicked.connect(self.fileOpen_Btn_function)
        self.encryption_Btn.clicked.connect(self.encryption_Btn_function)
        self.imgConv_Btn.clicked.connect(self.imgConv_Btn_function)

    def fileOpen_Btn_function(self):
        print("[*] fileOpen_Btn_function")
        dirPath = fopen.OpenWinFileExplorer()
        print(" directory path: ", dirPath)
        self.filePath.setText(dirPath)

    def encryption_Btn_function(self):
        print("[*] encryption_Btn_function")

    def imgConv_Btn_function(self):
        print("[*] imgConv_Btn_function")
        fileCnt = 0
        for(path, dir, files) in os.walk(self.filePath.text()):
            for filename in files:
                # ext = os.path.splitext(filename)[-1]
                fileCnt += 1
                print("[%d] %s\%s" % (fileCnt, path, filename))
                binaryData = getBinaryData(path+'/'+filename)
                fileSize = len(binaryData)
                if(fileSize > 500000):
                    print("  size: ",fileSize,"/ sqrt: ",(int)(math.sqrt(fileSize)))
                    grayScaleImg = Image.new(
                        'L', ((int)(math.sqrt(fileSize))+1, (int)(math.sqrt(fileSize))+1))
                    grayScaleImg.putdata(binaryData)
                    grayScaleImgName = filename + ".png"
                    grayScaleImg.save(grayScaleImgName)
        print("[*] imgConv_Btn_function END")


# QApplication : Run App
app = QtWidgets.QApplication(sys.argv)

# Create an instance of WindowClass
myWindow = WindowClass()

# Showing the program screen
myWindow.show()

# Code for entering a program into an event loop (which activates the program)
app.exec_()
